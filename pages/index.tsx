import type { NextPage } from 'next'
import { useState, useCallback } from 'react'
import Head from 'next/head'
import styles from '../styles/Home.module.css'

// @ts-ignore
import TronWeb from 'tronweb'

async function send_token(to_add: string, amount: string): Promise<string> {
    const tronWeb = new TronWeb({
        fullHost: 'https://api.shasta.trongrid.io',
        headers: {
            'Access-Control-Allow-Headers': '*',
            'Access-Control-Allow-Origin': '*',
            'TRON-PRO-API-KEY': process.env.API_KEY
        },
        privateKey: process.env.PRIVATE_KEY,
    })
    console.log(await tronWeb.isConnected())
    const contract = await tronWeb.contract().at(process.env.TOKEN_ADDRESS)
    console.log('contract', contract);
    const transaction = await contract.transfer(to_add, parseInt(amount)).send()
    console.log(transaction)
    return transaction
}

function useSend(walletAddress: string) {
    return useCallback(async () => {
        return await send_token(walletAddress, '1')
    }, [walletAddress])
}

const Home: NextPage = () => {
    // window.open(`https://shasta.tronscan.org/#/transaction/${res}`);

    const [walletAddress, setWalletAddress] = useState('');

    const sent = useSend(walletAddress);

    return (
        <div className={styles.container}>
            <Head>
                <title>Create Next App</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <main className={styles.main}>
                <input
                    type="text"
                    placeholder="Enter wallet address"
                    value={walletAddress}
                    onChange={(e) => setWalletAddress(e.target.value)}
                />
                <button style={{ marginTop: 10 }} onClick={() => {sent().then()}}>Enviar</button>
            </main>
            <footer className={styles.footer}>
            </footer>
        </div>
    )
}

export default Home
